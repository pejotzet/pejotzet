<!DOCTYPE html>
<!-- `site.alt_lang` can specify a language different from the UI --><html lang="pl">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover">

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2">
<meta property="og:title" content="Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code">
<meta name="author" content="Piotr Zawadzki">
<meta property="og:locale" content="pl">
<meta name="description" content="Komputery jednopłytkowe (ang. SBC — Single Board Computer) to uniwersalne urządzenia mikroprocesorowe pracujące pod kontrolą systemu operacyjnego. Zazwyczaj systemem tym jest Linux. Architektury komputerów jednopłytkowych mogą istotnie się różnić od architektur stosowanych dla komputerów osobistych. W rezultacie przygotowanie aplikacji w postaci binarnej na urządzenie docelowe (target) na komputerze osobistym (host) wymaga wielu, często dość skomplikowanych, zabiegów. Uwaga niniejszego opracowania skupiona jest na realizacji różnych scenariuszy pracy z wykorzystaniem edytora VS Code i eliminujących konieczność instalacji i konfiguracji środowiska graficznego na SBC.">
<meta property="og:description" content="Komputery jednopłytkowe (ang. SBC — Single Board Computer) to uniwersalne urządzenia mikroprocesorowe pracujące pod kontrolą systemu operacyjnego. Zazwyczaj systemem tym jest Linux. Architektury komputerów jednopłytkowych mogą istotnie się różnić od architektur stosowanych dla komputerów osobistych. W rezultacie przygotowanie aplikacji w postaci binarnej na urządzenie docelowe (target) na komputerze osobistym (host) wymaga wielu, często dość skomplikowanych, zabiegów. Uwaga niniejszego opracowania skupiona jest na realizacji różnych scenariuszy pracy z wykorzystaniem edytora VS Code i eliminujących konieczność instalacji i konfiguracji środowiska graficznego na SBC.">
<link rel="canonical" href="https://mikroprofesor.duckdns.org/posts/C-Cpp-development-for-SBC-in-Code/">
<meta property="og:url" content="https://mikroprofesor.duckdns.org/posts/C-Cpp-development-for-SBC-in-Code/">
<meta property="og:site_name" content="Net i Dev Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-08-12T15:13:20+02:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Piotr Zawadzki"},"dateModified":"2023-08-12T15:13:20+02:00","datePublished":"2023-08-12T15:13:20+02:00","description":"Komputery jednopłytkowe (ang. SBC — Single Board Computer) to uniwersalne urządzenia mikroprocesorowe pracujące pod kontrolą systemu operacyjnego. Zazwyczaj systemem tym jest Linux. Architektury komputerów jednopłytkowych mogą istotnie się różnić od architektur stosowanych dla komputerów osobistych. W rezultacie przygotowanie aplikacji w postaci binarnej na urządzenie docelowe (target) na komputerze osobistym (host) wymaga wielu, często dość skomplikowanych, zabiegów. Uwaga niniejszego opracowania skupiona jest na realizacji różnych scenariuszy pracy z wykorzystaniem edytora VS Code i eliminujących konieczność instalacji i konfiguracji środowiska graficznego na SBC.","headline":"Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code","mainEntityOfPage":{"@type":"WebPage","@id":"https://mikroprofesor.duckdns.org/posts/C-Cpp-development-for-SBC-in-Code/"},"url":"https://mikroprofesor.duckdns.org/posts/C-Cpp-development-for-SBC-in-Code/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code | Net i Dev Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Net i Dev Blog">
<meta name="application-name" content="Net i Dev Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net">
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&amp;display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/myavatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <div class="site-title">
      <a href="/">Net i Dev Blog</a>
    </div>
    <div class="site-subtitle fst-italic">Spisano ku pamięci i na pożytek</div>
  </div>
  <!-- .profile-wrapper -->

  <ul class="nav flex-column flex-grow-1 w-100 ps-0">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home"></i>
        <span>STRONA GŁÓWNA</span>
      </a>
    </li>
    <!-- the real tabs -->
    
      <li class="nav-item">
        <a href="/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream"></i>
          

          <span>KATEGORIE</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/tags/" class="nav-link">
          <i class="fa-fw fas fa-tags"></i>
          

          <span>ZNACZNIKI</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive"></i>
          

          <span>ARCHIWUM</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/about/" class="nav-link">
          <i class="fa-fw fas fa-info-circle"></i>
          

          <span>O STRONIE</span>
        </a>
      </li>
      <!-- .nav-item -->
    
  </ul>
  <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a href="https://github.com/pejotzet" aria-label="github" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a href="javascript:location.href%20=%20'mailto:'%20+%20['Zawadzki.Piotrus','gmail.com'].join('@')" aria-label="email">
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a href="/feed.xml" aria-label="rss">
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</div>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container px-xxl-5">
        <!-- The Top Bar -->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100">
    <span id="breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Strona główna
              </a>
            </span>

          
        
          
        
          
            
              <span>Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code</span>
            

          
        
      
    </span>
    <!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel">Cancel</span>
  </div>
</div>

        











<div class="row">
  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4">
    

    <div class="post px-1 px-md-2">
      

      
        
      
        <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->



  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- return -->




<h1 data-toc-skip>Jak kompilować i debugować aplikacje w C/C++ na komputery jednopłytkowe korzystając z VS Code</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Opublikowano
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="" data-ts="1691846000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom">
  Aug 12, 2023
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      

      <em>
      
        
          <a href=""></a>
          
        
      
      </em>
    </span>

    <div>
      <!-- read time -->
      <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3991 słów">
  <em>22 min</em> czytania</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Komputery jednopłytkowe (ang. <code class="language-plaintext highlighter-rouge">SBC</code> — <em>Single Board Computer</em>) to uniwersalne urządzenia mikroprocesorowe pracujące pod kontrolą systemu operacyjnego.
Zazwyczaj systemem tym jest Linux.
Architektury komputerów jednopłytkowych mogą istotnie się różnić od architektur stosowanych dla komputerów osobistych.
W rezultacie przygotowanie aplikacji w postaci binarnej na urządzenie docelowe (<em>target</em>) na komputerze osobistym (<em>host</em>) wymaga wielu, często dość skomplikowanych, zabiegów.
Uwaga niniejszego opracowania skupiona jest na realizacji różnych scenariuszy pracy z wykorzystaniem edytora <code class="language-plaintext highlighter-rouge">VS Code</code> i eliminujących konieczność instalacji i konfiguracji środowiska graficznego na <code class="language-plaintext highlighter-rouge">SBC</code>.</p>

<!--more-->

<p>Producenci urządzeń klasy <code class="language-plaintext highlighter-rouge">SBC</code> nieustannie przekonują potencjalnych nabywców, że urządzenia te mogą funkcjonować jako ubogie wersje komputerów osobistych, jednak nie znam nikogo, kto używałby ich w ten sposób.
Tak naprawdę siłą komputerów tego typu jest dostępność niskopoziomowych interfejsów takich, jak linie <code class="language-plaintext highlighter-rouge">GPIO</code> czy magistrale <code class="language-plaintext highlighter-rouge">I2C</code>, <code class="language-plaintext highlighter-rouge">SPI</code> przy jednoczesnej dostępności wielu serwisów sieciowych.
Jądro systemu operacyjnego zainstalowanego na takim urządzeniu zapewnia abstrakcyjny interfejs dostępu sprzętu, dzięki czemu aplikacje wyglądają w zasadzie tak samo, niezależnie od platformy sprzętowej wykorzystanej do realizacji urządzenia <code class="language-plaintext highlighter-rouge">SBC</code>.</p>

<p>Idealną sytuacją byłoby, gdyby aplikacje dla komputera jednopłytkowego można było tworzyć, budować i uruchamiać bezpośrednio na nim. Komfortowa praca wymaga jednak uruchomienia konsoli graficznej (instalacji oprogramowania oraz doposażenia w dodatkowy sprzęt w postaci myszy, klawiatury i monitora), zapewnienia odpowiedniej przestrzeni dyskowej i wystarczającego rozmiaru pamięci RAM.
Scenariusz taki jest możliwy, gdy <code class="language-plaintext highlighter-rouge">SBC</code> ma zasoby porównywalne z komputerami <code class="language-plaintext highlighter-rouge">PC</code>.
W zdecydowanej większości przypadków tak nie jest.</p>

<p>We wszystkich opisanych dalej scenariuszach <strong>jedynym</strong> interfejsem programisty będzie
<a href="https://code.visualstudio.com/"><em>Visual Studio Code</em></a> – doceniony przez programistów i wysoce konfigurowalny edytor.
Mechanizm rozszerzeń w edytorze umożliwia jego uzupełnienie o funkcje budowania i uruchamiania aplikacji co <em>de facto</em> przekształca go w zintegrowane środowisko pracy. 
<code class="language-plaintext highlighter-rouge">VS Code</code> jest dostępny nieodpłatnie na wszystkie popularne systemy operacyjne. 
Pracę z projektami C/C++ znacznie ułatwia <code class="language-plaintext highlighter-rouge">*C/C++ Extension Pack*</code>. 
Dalej przyjęto, że rozszerzenie to jest zainstalowane.
Rozważane są scenariusze pracy w których kod aplikacji jest budowany na urządzeniu docelowym lub komputerze <code class="language-plaintext highlighter-rouge">PC</code>.</p>

<h2 id="1-kompilacja-natywna">
<span class="me-2">1. Kompilacja natywna</span><a href="#1-kompilacja-natywna" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Opisane w tym punkcie scenariusze wymagają instalacji w systemie <em>target</em> narzędzi umożliwiających budowanie aplikacji, np.</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>apt <span class="nb">install</span> <span class="nt">-y</span> build-essentials make
apt <span class="nb">install</span> <span class="nt">-y</span> libgpiod-dev
</pre></td>
</tr></tbody></table></code></div>
</div>

<p><code class="language-plaintext highlighter-rouge">VS Code</code> jest wykorzystywane jedynie do zapewnienia programiście wygodnego interfejsu graficznego.</p>

<h3 id="11-praca-zdalna-z-wykorzystaniem-code-server">
<span class="me-2">1.1 Praca zdalna z wykorzystaniem <em>Code Server</em></span><a href="#11-praca-zdalna-z-wykorzystaniem-code-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Instalacja w <em>Visual Studio Code</em> rozszerzenia <em>Remote SSH</em> umożliwia pracę zdalną na dowolnym koncie <em>SSH</em>, tak jak gdyby był to komputer lokalny. W procesie automatycznej konfiguracji zdalnego konta na systemie <em>target</em> jest instalowany i uruchamiany <a href="https://code.visualstudio.com/docs/remote/vscode-server"><em>Code Server</em></a>.
Otwarcie zdalnej sesji przebiega następująco:</p>

<ul>
  <li>
    <p>po uruchomieniu <em>Visual Studio Code</em> wystarczy wybrać zielony przycisk “<a href="connect-button.png" class="popup img-link "><img data-src="connect-button.png" alt="connect-button" class="lazyload" data-proofer-ignore></a>” w lewym dolnym rogu ekranu</p>
  </li>
  <li>
    <p>z palety komend wybrać “<em>Connect to Host</em>”,</p>
  </li>
  <li>
    <p>w polu adresu wpisać <code class="language-plaintext highlighter-rouge">root@opi.usb</code> (“root” można zamienić na dowolne inne konto, “opi.usb” jest nazwą sieciową systemu <em>target</em> i może być zamieniona na stosowny numer IP),</p>
  </li>
</ul>

<p>Rozszerzenie <em>Remote SSH</em> automatycznie zainstaluje na zdalnym koncie oprogramowanie <em>Code Server</em> (w katalogu ‘.vscode’ na zdalnym koncie) umożliwiające egzekucję i odbieranie wyników komend wydawanych w tunelu SSH.
Praca w takiej konfiguracji jest bardzo wygodna i w zasadzie niczym nie różni się od pracy lokalnej. Jedyna różnica polega na tym, że źródła aplikacji i narzędzia ich kompilacji muszą być obecne na systemie <em>target</em>. Na systemie <em>host</em> nie trzeba instalować nić oprócz <code class="language-plaintext highlighter-rouge">Visual Studio Code</code>.
Niestety, przedstawione rozwiązanie ma dwie (poważne) wady:</p>

<ul>
  <li>
    <p><em>code-server</em> wspiera tylko architektury 64-bitowe: <em>amd64</em> i <em>arm64</em>, co na wyklucza zastosowanie tego podejścia na wielu dostępnych na rynku <code class="language-plaintext highlighter-rouge">SBC</code>,</p>
  </li>
  <li>
    <p>system <em>target</em> powinien być wyposażony w 1GB RAM i dwurdzeniowy CPU.</p>
  </li>
</ul>

<h3 id="12-praca-zdalna-w-tunelu-ssh">
<span class="me-2">1.2 Praca zdalna w tunelu SSH</span><a href="#12-praca-zdalna-w-tunelu-ssh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Poprzednia metoda nie jest uniwersalna ze względu na wymagania stawiane przez <em>Code Server</em>.
Element ten można wyeliminować z poprzedniego schematu.
Tym razem pliki źródłowe są edytowane na systemie <em>host</em> i przed kompilacją kopiowane na system <em>target</em>, gdzie są kompilowane za pomocą natywnych narzędzi.
W toku dalszego wywodu zostanie przyjęto następującą strukturę podkatalogów w katalogu projektu</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre>.vscode/ -&gt; katalog z plikami konfiguracyjnymi IDE
obj/ -&gt; katalog pomocniczy dla make
src/ -&gt; pliki źródłowe projektu
src/include/
src/main.c
Makefile 
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Powyższy projekt można zbudować natywnie, korzystając z następującego ‘<em>Makefile</em>’</p>

<pre><code class="language-Makefile"># Compiler settings - Can be customized.
CC = gcc
CXX = g++
CPPFLAGS =
CFLAGS = -std=c11 -g -Wall -fdiagnostics-color=always
CXXFLAGS = -std=c++11 -g -Wall -fdiagnostics-color=always
LDFLAGS = -lpthread -lgpiod

# Makefile settings - Can be customized.
APPNAME = main
EXT = .c
SRCDIR = src
OBJDIR = obj
REMOTE = root@opi.usb
REMOTEPWD = /root/RemotePowerButton

SRC = $(wildcard $(SRCDIR)/*$(EXT))
OBJ = $(SRC:$(SRCDIR)/%$(EXT)=$(OBJDIR)/%.o)
DEP = $(OBJ:$(OBJDIR)/%.o=%.d)

RM = rm

all: $(APPNAME)

# Copy sources to target
copysrc:
  scp -p -r ./src/ ./obj/ ./Makefile $(REMOTE):$(REMOTEPWD)

# Builds the app
$(APPNAME): $(OBJ)
  $(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

# Creates the dependecy rules
%.d: $(SRCDIR)/%$(EXT)
  @$(CPP) $(CFLAGS) $(CPPFLAGS) $&lt; -MM -MT $(@:%.d=$(OBJDIR)/%.o) &gt;$@

# Includes all .h files
-include $(DEP)

# Building rule for .o files and its .c/.cpp in combination with all .h
$(OBJDIR)/%.o: $(SRCDIR)/%$(EXT)
  $(CC) $(CFLAGS) $(CPPFLAGS) -o $@ -c $&lt;

# Cleans complete project
.PHONY: clean
clean:
  -$(RM) $(OBJ) $(DEP) $(APPNAME)

# Cleans only all files with the extension .d
.PHONY: cleandep
cleandep:
  -$(RM) $(DEP)
</code></pre>

<p>W powyższym pliku cel ‘<em>copysrc</em>’ odpowiada za skopiowanie na system <em>target</em> struktury katalogów i plików niezbędnych do zbudowania aplikacji.</p>

<p>Plikiem konfiguracyjnym mówiącym <em>Visual Studio Code</em> jak należy dany projekt budować, jest plik ‘<em>.vscode/tasks.json</em>’.
Każdy projekt może mieć kilka zadań, do których odwołujemy się przez nazwę nadaną w polu ‘<em>label</em>’. Zadania budowania konfiguruje się w menu ‘<em>Terminal</em>’.
Konfiguracja zadania, które kopiuje pliki źródłowe na system <em>target</em>, a następnie zdalnie wykonuje na nim polecenie ‘<em>make</em>’ wygląda następująco (plik ‘<em>.vscode/tasks.json</em>’):</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Native Build on Target"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make copysrc ; ssh root@opi.usb '(cd /root/RemotePowerButton; make)'"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task copies project sources to target and then it builds them natively there."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Przyjęto, że zdalnym katalogiem projektu jest ‘<em>/root/RemotePowerButton</em>’. Procedurę budowania aktywuje się skrótem klawiszowym ‘<em>Ctrl+Shift+B</em>’.</p>

<p>Edytor <em>Visual Studio Code</em> jest wyposażony w mechanizm <a href="https://code.visualstudio.com/docs/editor/intellisense"><em>IntelliSense</em></a> bardzo ułatwiający pisanie kodu źródłowego poprzez zastosowanie zaawansowanego mechanizmu podpowiedzi nt. zdefiniowanych zmiennych, dostępnych funkcji, akceptowanych przez nie argumentów itp.
<em>IntelliSense</em> czerpie swoją wiedzę z analizy treści plików nagłówkowych.
W przedstawionej tutaj konfiguracji problem polega na tym, że <em>IntelliSense</em> korzysta z plików nagłówkowych w systemie <em>host</em>, które mogą być zupełnie odmienne od odpowiednich plików w systemie <em>target</em>.
Aby tę niefortunny stan rzeczy naprawić, należy pliki nagłówkowe z systemu <em>target</em> udostępnić <em>IntelliSense</em>.
Procedura jest dwuetapowa:</p>

<ol>
  <li>
    <p>pliki nagłówkowe z systemu <em>target</em>, muszą być widoczne w systemie <em>host</em>,</p>
  </li>
  <li>
    <p><em>IntelliSense</em> musi być poinformowane, gdzie się te pliki znajdują.</p>
  </li>
</ol>

<p>Punkt 1. można zrealizować na dwa sposoby:</p>

<ul>
  <li>
    <p>metodą “brutalnej siły” polegającej na skopiowaniu rzeczonych plików nagłówkowych na system <em>host</em> (przeniesienie atrybutu właściciela pliku nie jest konieczne),</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="c"># w katalogu projektu na systemie host</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> rootfs/usr/include
scp <span class="nt">-r</span> root@opi.usb:/usr/include rootfs/usr/include/
</pre></td>
</tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>metodą “elegancką” polegającą na <a href="#udost%C4%99pnianie-g%C5%82%C3%B3wnego-systemu-plik%C3%B3w-poprzez-nfs">udostępnieniu w trybie <em>tylko do odczytu</em> odpowiedniego fragmentu systemu plików systemu <em>target</em> z wykorzystaniem protokołu NFS</a>.</p>
  </li>
</ul>

<p>Metoda “brutalnej siły” ma tę wadę, że przynajmniej co do zasady, powinna być powtórzona po każdorazowej aktualizacji oprogramowania na systemie <em>target</em>.
Metodę elegancką opisano w punkcie <a href="#kruczki-i-sztuczki">“Kruczki i sztuczki”</a>.</p>

<p>Następnie, korzystając z pliku ‘<em>.vscode/c_cpp_properties.json</em>’ należy poinformować <em>IntelliSense</em>, które pliki powinny być analizowane</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Target Rootfs"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"includePath"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/src/**"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/rootfs/**"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"defines"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">symbols</span><span class="w"> </span><span class="err">resolved</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">preprocessor</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">unknown</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">IntelliSense</span><span class="w">
                </span><span class="s2">"NULL=0"</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">suspect</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="s2">"#     define NULL 0"</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">types.h</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">accepted</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">cpp</span><span class="p">,</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">IGNORED</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">IntelliSense</span><span class="w"> 
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"compilerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cppStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c++11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"intelliSenseMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linux-gcc-arm64"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Zagadnienie udostępnienia właściwych plików nagłówkowych będzie się przewijało we wszystkich opisywanych dalej konfiguracjach. W wersji korzystającej z plików udostępnionych za pomocą NFS katalog ‘<em>rootfs</em>’ może być po prostu linkiem symbolicznym do katalogu, w którym widoczne są pliki urządzenia <em>target</em>.</p>

<h2 id="2-kompilacja-skrośna">
<span class="me-2">2. Kompilacja skrośna</span><a href="#2-kompilacja-skro%C5%9Bna" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Proces budowania aplikacji złożony jest dwóch zasadniczych etapów:</p>

<ul>
  <li>
    <p><em>kompilacji</em>, czyli przekształcenia kodu źródłowego na kod binarny dla docelowej architektury,</p>
  </li>
  <li>
    <p><em>łączenia</em> (ang. <em>liniking</em>), czyli zebrania wielu fragmentów kodu binarnego w jedną aplikację.</p>
  </li>
</ul>

<p>Kompilacji podlega kod źródłowy stworzony przez twórcę oprogramowania wraz z kodem zawartym w plikach nagłówkowych bibliotek.
Łączeniu podlega kod binarny wyprodukowany w procesie kompilacji z kodem binarnym bibliotek. Kompilator czerpie z plików nagłówkowych informację o kodzie, który będzie dostępny na etapie łączenia, zatem oba te elementy muszą pozostawać w pełnym synchronizmie.
Sam proces łączenia ma dwie odmiany.
W łączeniu <em>statycznym</em> wymuszanym na linkerze opcją <code class="language-plaintext highlighter-rouge">-static</code> kod binarny aplikacji oraz wspomagający go kod z bibliotek są ‘sklejane’ w jeden plik.
Tak zbudowana aplikacja jest samowystarczalna, jednak jej kod wynikowy może być bardzo duży (np. użycie funkcji <em>printf</em> implikuje dołączenie znacznego fragmentu standardowej biblioteki C).
Bez opcji <code class="language-plaintext highlighter-rouge">-static</code> linker pracuje w trybie łączenia <em>dynamicznego</em>, w którym kod binarny aplikacji jest uzupełniany informacją <strong>o nazwie i wersji biblioteki</strong>, o którą powinien być uzupełniony w momencie uruchomienia. Dzięki takiemu podejściu kod wynikowy aplikacji jest stosunkowo mały, a biblioteki wykorzystywane przez wiele aplikacji są ładowane do pamięci tylko raz. Niestety, w momencie uruchomienia aplikacja nie jest samodzielna jak w przypadku łączenia statycznego, gdyż system, w którym jest uruchamiana, musi być uzupełniony o biblioteki współdzielone niezbędne do działania aplikacji (z dokładnością do wersji biblioteki, aby zapewnić zgodność interfejsu biblioteki zakładanego podczas kompilacji).
Ostatecznie budowanie skrośne wymaga spełnienia następujących warunków:</p>

<ol>
  <li>
    <p>kompilator musi wytwarzać kod binarny zgodny z architekturą urządzenia <em>target</em>,</p>
  </li>
  <li>
    <p>przetwarzane przez kompilator pliki nagłówkowe muszą być zgodne z kodem binarnym łączonym przez linker,</p>
  </li>
  <li>
    <p>na etapie uruchamiania, dla programów łączonych dynamicznie, w systemie <em>target</em> muszą być zainstalowane <strong>dokładnie te same</strong> biblioteki, które były przyjęte na etapie łączenia.
Mówiąc krótko, architektura kodu, deklaracje zawarte w kodach nagłówkowych i biblioteki podczas łączenia i uruchamiania aplikacji <strong>muszą</strong> do siebie pasować.</p>
  </li>
</ol>

<p>Podstawowym problemem skrośnego tworzenia oprogramowania jest konstrukcja środowiska gwarantującego spełnienie warunków 1-3.
Ich poprawne spełnienie wymaga istotnej ingerencji w oprogramowanie zainstalowane na systemie <em>host</em>.
Zestaw narzędzi umożliwiających przygotowanie kodu binarnego na architekturę inną niż architektura systemu na którym wykonywania jest kompilacja nazywa się <code class="language-plaintext highlighter-rouge">toolchain</code>‘em.
Nazwa ta podkreśla fakt, że skrośne budowanie aplikacji wymaga zharmonizowanego użycia wielu narzędzi.</p>

<p><code class="language-plaintext highlighter-rouge">Skrośne budowanie aplikacji jest żmudne i podatne na błędy</code></p>

<h3 id="21-instalacja-kompilatora-skrośnego-w-systemie-host">
<span class="me-2">2.1 Instalacja kompilatora skrośnego w systemie <em>host</em></span><a href="#21-instalacja-kompilatora-skro%C5%9Bnego-w-systemie-host" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Budowanie skrośne jest stosunkowo proste, gdy dla systemu <em>host</em> istnieje gotowy pakiet zawierający zestaw narzędzi do skrośnego budowania aplikacji (tzw. <em>toolchain</em>) oraz podstawowe biblioteki dla architektury docelowej</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>apt list <span class="s2">"crossbuild*"</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Jego instalacja umożliwia bezproblemową kompilację prostych aplikacji.
Problem koegzystencji został rozwiązany poprzez zastosowanie konwencji nazewniczej polegającej na poprzedzeniu każdego programu wchodzącego w skład toolchainu prefiksem opisującym platformę docelową w formacie (łącznik na końcu prefiksu jest jego integralną częścią)</p>

<pre><code class="language-txt">&lt;arch&gt;-&lt;os&gt;-&lt;lib&gt;-
</code></pre>

<pre><code class="language-txt">&lt;arch&gt;-&lt;vendor&gt;-&lt;os&gt;-&lt;lib&gt;-
</code></pre>

<p>Na przykład typowymi prefiksami dla architektury ARM64 są <code class="language-plaintext highlighter-rouge">aarch64-linux-gnu-</code> lub <code class="language-plaintext highlighter-rouge">aarch64-unknown-linux-gnu-</code></p>

<h4 id="łączenie-statyczne">
<span class="me-2">Łączenie statyczne</span><a href="#%C5%82%C4%85czenie-statyczne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<p>Szansa, że wersje bibliotek zainstalowanych w ‘<em>crossbuild</em>’ pokrywają się z bibliotekami w środowisku uruchomiania, jest niewielka, zatem konieczne jest uwolnienie się od warunku 3, poprzez wymuszenie łączenia statycznego np.</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">PREFIX</span><span class="o">=</span>aarch64-linux-gnu- <span class="p">;</span> <span class="k">${</span><span class="nv">PREFIX</span><span class="k">}</span>gcc <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-Wall</span> <span class="nt">-o</span> main.o main.c <span class="p">;</span> <span class="k">${</span><span class="nv">PREFIX</span><span class="k">}</span>gcc <span class="nt">-static</span> main.o
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Kompilator i linker skrośny ‘wiedzą’, gdzie w systemie <em>host</em> zainstalowano pliki stosowne dla architektury docelowej, co znacznie upraszcza składnię komend niezbędnych do skutecznego zbudowania aplikacji.
Aplikacja zbudowana jak wyżej może być uruchomiona na dowolnym systemie zgodnym z architekturą zdefiniowaną w zmiennej <code class="language-plaintext highlighter-rouge">PREFIX</code>.
Jednak za prostotę płacimy cenę: po pierwsze, aplikacja jest stosunkowo duża i po drugie, uzupełnienie zależności o bibliotekę, której brak w pakiecie ‘crossbuild*’ wymaga ręcznej kompilacji skrośnej biblioteki i ujęcia jej <em>explicite</em> w wywołaniach kompilatora i linkera.</p>

<h4 id="łączenie-dynamiczne">
<span class="me-2">Łączenie dynamiczne</span><a href="#%C5%82%C4%85czenie-dynamiczne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<p>Budowanie skrośne wykorzystujące łączenie dynamiczne jest bardziej złożone, gdyż na systemie <em>host</em> muszą znajdować <strong>te same</strong> biblioteki dynamiczne/współdzielone co na systemie <em>target</em>.
Spełnienie punktu 3 implikuje również instalację plików nagłówkowych skojarzonych z tymi bibliotekami.
Katalog zawierający te elementy jest nazywany <em>sysroot</em>. Zarówno kompilator skrośny, jak i linker skrośny muszą być poinformowane o jego położeniu. Zawartość <em>sysroot</em> ekstrahuje się z głównego systemu plików systemu <em>target</em>.
Wymóg utrzymania synchronizmu wymusza aktualizację jego kopii na systemie <em>host</em> po zmianie firmware na urządzeniu <em>target</em>.</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">PREFIX</span><span class="o">=</span>aarch64-linux-gnu- <span class="p">;</span> <span class="nv">SYS</span><span class="o">=</span>rootfs <span class="p">;</span><span class="k">${</span><span class="nv">PREFIX</span><span class="k">}</span>gcc <span class="nt">--sysroot</span> <span class="k">${</span><span class="nv">SYS</span><span class="k">}</span> <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-Wall</span> <span class="nt">-o</span> main.o main.c <span class="p">;</span> <span class="k">${</span><span class="nv">PREFIX</span><span class="k">}</span>gcc <span class="nt">--sysroot</span> <span class="k">${</span><span class="nv">SYS</span><span class="k">}</span> main.o
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Wartość zmiennej <code class="language-plaintext highlighter-rouge">PREFIX</code> jest używana do rozmieszczania plików w drzewie katalogów na etapie przygotowywania <code class="language-plaintext highlighter-rouge">rootfs</code>.
Jednocześnie jest ona wykorzystywana przez kompilator skrośny do poszukiwania plików.
Zatem łączenie dynamiczne aby prefiks kompilatora był taki sam jak dla <code class="language-plaintext highlighter-rouge">rootfs</code>.</p>

<p><strong>Spełnienie tego warunku jest konieczne do bezproblemowej kompilacji i łączenia w trybie dynamicznym</strong></p>

<p>Inną, bardziej elegancką metodą zapewnienia widoczności plików z urządzenia <em>target</em> jest ich <a href="#udost%C4%99pnianie-g%C5%82%C3%B3wnego-systemu-plik%C3%B3w-poprzez-nfs">udostępnienie z wykorzystaniem protokołu NFS</a>.</p>

<p>Poniżej przedstawiono definicje zadań kompilacji statycznej i dynamicznej w <em>Visual Studio Code</em>.
Dla kompilacji dynamicznej przyjęto założenie, że system plików urządzenia <em>target</em> jest widoczny w katalogu ‘<em>rootfs/</em>’.</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CrossBuild with static linkage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make PREFIX=aarch64-linux-gnu- STATIC=-static"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task creates static application produced with cross compiler installed on host."</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CrossBuild with dynamic linkage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make PREFIX=aarch64-linux-gnu- SYSROOT=rootfs/"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task creates dynamically linked application produced with cross compiler installed on host. Target's rootfs is visible in rootfs/ folder."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="22-konteneryzacja-środowiska-kompilacji-skrośnej">
<span class="me-2">2.2 Konteneryzacja środowiska kompilacji skrośnej</span><a href="#22-konteneryzacja-%C5%9Brodowiska-kompilacji-skro%C5%9Bnej" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Instalowanie w systemie <em>host</em> kilku środowisk skrośnych prowadzi do dość sporego zamieszania w organizacji plików, zwłaszcza jeżeli narzędzia te pochodzą z równych źródeł.
Atrakcyjną alternatywą jest zamknięcie tych środowisk w kontenerach <code class="language-plaintext highlighter-rouge">Docker</code>‘a.
Zaletą jest o wiele łatwiejsze zarządzanie i całkowity brak interferencji pomiędzy tak zorganizowanymi środowiskami.
W ramach projektu <a href="https://github.com/dockcross/dockcross/"><code class="language-plaintext highlighter-rouge">Dockcross</code></a> zamknięto w kontenerach narzędzia kompilacji na wiele platform docelowych.
Ich zawartość obejmuje narzędzia do budowania aplikacji oraz standardową bibliotekę C (zrealizowaną jako <code class="language-plaintext highlighter-rouge">GNU C</code>, <code class="language-plaintext highlighter-rouge">musl</code> lub <code class="language-plaintext highlighter-rouge">uClib</code>).
Korzystanie z kontenerów jest wyjątkowo proste: instalacja sprowadza się do jednej komendy, a budowanie aplikacji wymagaja kosmetycznego retuszu pliku <code class="language-plaintext highlighter-rouge">Makefile</code>.
Dostępne typy architektur można sprawdzić w repozytorium <code class="language-plaintext highlighter-rouge">GitHub</code> projektu <a href="https://github.com/dockcross/dockcross">https://github.com/dockcross/dockcross</a> lub na <a href="https://hub.docker.com/u/dockcross">https://hub.docker.com/</a>.</p>

<p>Instalację środowiska realizuje komenda</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>docker run <span class="nt">--rm</span> dockcross/arch-name <span class="o">&gt;</span> ./dockcross
<span class="nb">chmod</span> +x ./dockcross
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>W jej wyniku na system <em>host</em> zostanie pobrany odpowiedni kontener, a w katalogu projektu utworzony skrypt <code class="language-plaintext highlighter-rouge">dockcross</code> umożliwiający korzystanie z jego zawartości.
Jeżeli kontener ma być używany również w innych projektach to skrypt należy przenieść do katalogu znajdującego się na ścieżce dostępu i zmienić jego nazwę na taką, która informuje o nazwie architektury. 
Parametry linii komend tego skryptu traktowane są jak linia poleceń, którą należy przekazać do kontenera.
Jednocześnie bieżący katalog jest mapowany do wnętrza kontenera, co powoduje, że pliki projektu są dostępne dla kompilatora w katalogu roboczym kontenera.
Na przykład, aby sprawdzić jak nazywa się kompilator umieszczony w kontenerze wystarczy wydać komendę</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>./dockcross bash <span class="nt">-c</span> <span class="s1">'echo $CC'</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Powyższa komenda pozwala na ustalenie wartości zmiennej <code class="language-plaintext highlighter-rouge">PREFIX</code> używanej we wcześniejszych przykładach.
Na przykład dla kontenera <code class="language-plaintext highlighter-rouge">dockcross/linux-arm64</code> przyjmie ona wartość <code class="language-plaintext highlighter-rouge">aarch64-unknown-linux-gnu-</code>.
W rezultacie komenda realizująca kompilację skrośną wymaga prostego uzupełnienia o wywołanie skryptu</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>./dockcross bash <span class="nt">-c</span> <span class="s1">'PREFIX=aarch64-unknown-linux-gnu- ; ${PREFIX}gcc -c -g -Wall -o main.o main.c ; ${PREFIX}gcc -static main.o -o myapp'</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Containerized CrossBuild with static linkage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./dockcross bash -c 'make PREFIX=aarch64-unknown-linux-gnu- STATIC=-static'"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task creates static application produced with cross compiler installed dockcross container (https://github.com/dockcross/dockcross)."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Niestety, z dużym prawdopodobieństwem kompilator zawarty w kontenerze będzie niekompatybilny z kompilatorem użytym do wytworzenia <code class="language-plaintext highlighter-rouge">rootfs</code>. W efekcie łączenie w trybie dynamicznym nie będzie możliwe.</p>

<h2 id="3-debugowanie-skrośne">
<span class="me-2">3. Debugowanie skrośne</span><a href="#3-debugowanie-skro%C5%9Bne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Natywne debugowanie kodu z wykorzystaniem GUI pracującego na systemie <em>target</em> jest często awykonalne, głównie ze względu na ograniczony interfejs użytkownika i niezbyt duże zasoby urządzenia.
Z kolei zdalna praca w konsoli tekstowej z debuggerem <em>gdb</em> jest doznaniem ekstremalnym.</p>

<p>Rozwiązaniem problemu jest podzielenie zadania uruchamiania na dwa oddzielne procesy. Proces <em>gdbserver</em> pracuje na systemie <em>target</em> i odpowiada za krokowe wykonywanie uruchamianej aplikacji.
Z kolei interfejs użytkownika uruchomiony na systemie <em>host</em> komunikuje się z serwerem poprzez sieć lub łącze szeregowe (w dalszej części pojawią się konfiguracje dla łącza sieciowego).
Programem uruchomionym na systemie <em>host</em> jest <em>gdb-multiarch</em> (jest to wersja <em>gdb</em>, która “rozumie” różne architektury). Oba komponenty komunikują się za pomocą protokołu TCP/IP.
W efekcie struktura komunikacji pomiędzy narzędziami jest następująca: interfejs GUI uruchomiony w systemie <em>host</em> komunikuje się lokalnie z <em>gdb-multiarch</em>, który z kolei poprzez sieć komunikuje się z <em>gdbserver</em> uruchomionym na systemie <em>target</em>.
GUI odpowiedzialne za przeprowadzenie sesji uruchamiania musi poinformować <em>gdb-multiarch</em> o architekturze uruchamianego kodu i adresie serwera oczekującego na połączenie.
W <em>Visual Studio Code</em> za konfigurację procesu uruchamiania odpowiedzialny jest plik ‘<em>.vscode/launch.json</em>’.
Dla rozważanego projektu przyjmie on postać</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GDB-REMOTE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cppdbg"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/main"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"miDebuggerServerAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"opi.usb:1234"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"miDebuggerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/usr/bin/gdb-multiarch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"targetArchitecture"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arm64"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"stopAtEntry"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"environment"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"externalConsole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MIMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gdb"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"setupCommands"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sets target architecture"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-ex 'set architecture aarch64'"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ignoreFailures"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable pretty-printing for gdb"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-enable-pretty-printing"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ignoreFailures"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Sesję uruchamiania aktywuje się skrótem “<em>F5</em>” lub wybierając ikonę “żuczka” <a href="bug.png" class="popup img-link "><img data-src="bug.png" alt="bug" class="lazyload" data-proofer-ignore></a> na pasku bocznym.
Powyższe zadanie realizuje tylko komunikację lokalną z <em>gdb-multiarch</em>, tak więc każdorazowo <strong><em>przed rozpoczęciem sesji uruchamiania</em></strong> należy w terminalu <em>Visual Studio Code</em> wydać komendę</p>

<div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>scp ./main root@opi.usb: <span class="o">&amp;&amp;</span> ssh <span class="nt">-t</span> root@opi.usb <span class="s2">"gdbserver --once localhost:1234 ./main"</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>Zadanie można sobie znacznie ułatwić, dopisując odpowiednie cele do ‘<em>Makefile</em>’</p>

<pre><code class="language-Makefile">debug: $(APPNAME)
  scp $(APPNAME) $(REMOTE): &amp;&amp; ssh -t $(REMOTE) "gdbserver --once localhost:1234 ./$(APPNAME)"

run: $(APPNAME)
  scp $(APPNAME) $(REMOTE): &amp;&amp; ssh -t $(REMOTE) "./$(APPNAME)"
</code></pre>

<h2 id="podsumowanie">
<span class="me-2">Podsumowanie</span><a href="#podsumowanie" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Kompilacja skrośna własnego kodu nastręcza wielu problemów.
Jeszcze więcej problemów pojawia się podczas kompilacji cudzych aplikacji.
Profesjonalnie napisane aplikacje są wyposażone w mechanizm budowy dostosowujący je do środowiska kompilacji.
Zazwyczaj budowanie aplikacji poprzedzonej jest uruchomieniem skryptu <code class="language-plaintext highlighter-rouge">./configure</code>wygenerowanym przez środowisko <code class="language-plaintext highlighter-rouge">automake</code>.
Zadaniem skryptu jest wykrycie dostępności pewnych składników systemie, ustawienie odpowiednich flag kompilacji i przygotowanie pliku <code class="language-plaintext highlighter-rouge">Makefile</code> dla programu <code class="language-plaintext highlighter-rouge">make</code>.
Schemat ten działa poprawnie gdy system na którym ma być wykonywania aplikacja jest identycznie skonfigurowany (w sensie dostępności wykrywanych składników) z systemem na którym wykonywana jest aplikacja.
W przypadku kompilacji skrośnej założenie to nie jest spełnione.
Skrypt <code class="language-plaintext highlighter-rouge">./configure</code> po prostu <strong>odpytuje niewłaściwy system</strong>.
W efekcie ustawione opcje kompilacji są niepoprawne, co skutkuje błędami kompilacji, lub co gorsza, wygenerowaniem niewłaściwie działającego kodu.
Ręczny dobór odpowiednich przełączników i adaptacja obcego kodu źródłowego jest zazwyczaj doznaniem ekstremalnym.</p>

<p><strong>W zasadzie wszystkie opisane problemy można rozwiązać stosując <a href="../../post/2023-08-13-emulated-building-for-sbc/">kompilację w trybie emulowanym</a>.</strong></p>

<h3 id="wady-i-zalety">
<span class="me-2">Wady i zalety</span><a href="#wady-i-zalety" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Budowanie natywne</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>zalety</th>
      <th>wady</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>możliwość tworzenie kodu łączonego dynamicznie</td>
      <td>konieczność instalacji narzędzi deweloperskich na urządzeniu <em>target</em>
</td>
    </tr>
    <tr>
      <td> </td>
      <td>tworzenie kodu wymaga bezpośredniego dostepu do urządzenia docelowego</td>
    </tr>
  </tbody>
</table></div>

<p>Budowanie skrośne</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>zalety</th>
      <th>wady</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>kompilacja na urządzeniu host</td>
      <td>kod łączony dynamicznie może być przygotowany tylko w specyficznych sytuacjach</td>
    </tr>
    <tr>
      <td>możliwość hermetyzacji środowiska w kontenerze</td>
      <td> </td>
    </tr>
  </tbody>
</table></div>

<h3 id="przydatne-pliki-konfiguracyjne">
<span class="me-2">Przydatne pliki konfiguracyjne</span><a href="#przydatne-pliki-konfiguracyjne" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">Makefile</code> na wszystkie okazje</p>

<pre><code class="language-Makefile"># Compiler settings - Can be customized.
PREFIX=
STATIC=
CC = $(PREFIX)gcc
CXX =$(PREFIX)g++
CPPFLAGS =
CFLAGS = -std=c11 -g -Wall -fdiagnostics-color=always
CXXFLAGS = -std=c++11 -g -Wall -fdiagnostics-color=always
# LDFLAGS = $(STATIC) -lpthread -lgpiod 
LDFLAGS = $(STATIC) 

ifdef SYSROOT
    CFLAGS += --sysroot=$(SYSROOT)
    CXXFLAGS += --sysroot=$(SYSROOT)
    LDLAGS += --sysroot=$(SYSROOT)
endif

# Makefile settings - Can be customized.
APPNAME = main
EXT = .c
SRCDIR = src
OBJDIR = obj
REMOTE = root@opi.usb
REMOTEPWD = /root/RemotePowerButton

SRC = $(wildcard $(SRCDIR)/*$(EXT))
OBJ = $(SRC:$(SRCDIR)/%$(EXT)=$(OBJDIR)/%.o)
DEP = $(OBJ:$(OBJDIR)/%.o=%.d)

RM = rm -f

all: $(APPNAME)

# Copy sources to target
.PHONY: copysrc
copysrc:
  scp -p -r ./src/ ./obj/ ./Makefile $(REMOTE):$(REMOTEPWD)

.PHONY: debug
debug: $(APPNAME)
  scp $(APPNAME) $(REMOTE): &amp;&amp; ssh -t $(REMOTE) "gdbserver --once localhost:1234 ./$(APPNAME)"

.PHONY: run
run: $(APPNAME)
  scp $(APPNAME) $(REMOTE): &amp;&amp; ssh -t $(REMOTE) "./$(APPNAME)"

# Builds the app
$(APPNAME): $(OBJ)
  $(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

# Creates the dependecy rules
%.d: $(SRCDIR)/%$(EXT)
  @$(CPP) $(CFLAGS) $(CPPFLAGS) $&lt; -MM -MT $(@:%.d=$(OBJDIR)/%.o) &gt;$@

# Includes all .h files
-include $(DEP)

# Building rule for .o files and its .c/.cpp in combination with all .h
$(OBJDIR)/%.o: $(SRCDIR)/%$(EXT)
  $(CC) $(CFLAGS) $(CPPFLAGS) -o $@ -c $&lt;

# Cleans complete project
.PHONY: clean
clean:
  $(RM) $(OBJ) $(DEP) $(APPNAME)

# Cleans only all files with the extension .d
.PHONY: cleandep
cleandep:
  $(RM) $(DEP)
</code></pre>

<p>Wszystkie definicje zadań `<em>.vscode/tasks.json</em>’</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CrossBuild with static linkage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make PREFIX=aarch64-linux-gnu- STATIC=-static"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task creates static application produced with cross compiler installed on host."</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CrossBuild with dynamic linkage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make PREFIX=aarch64-linux-gnu- SYSROOT=/mnt/sysroot"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task creates dynamically linked application produced with cross compiler installed on host. Targets rootfs is visible in /mnt/sysroot."</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Build Natively on Target"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make copysrc ; ssh root@opi.usb '(cd /root/RemotePowerButton; make)'"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="nl">"isDefault"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"$gcc"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This task copies project sources to target and then it builds them natively there."</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Konfiguracja <em>IntelliSense</em> w ‘<em>.vscode/c_cpp_properties.json</em>’</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NativeOverSSH"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"includePath"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/src/**"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/rootfs/**"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"defines"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">symbols</span><span class="w"> </span><span class="err">resolved</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">preprocessor</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">unknown</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">IntelliSense</span><span class="w">
                </span><span class="s2">"NULL=0"</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">suspect</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="s2">"#     define NULL 0"</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">types.h</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">accepted</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">cpp</span><span class="p">,</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">IGNORED</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">IntelliSense</span><span class="w"> 
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"compilerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cppStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c++11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"intelliSenseMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linux-gcc-arm64"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<p>Konfiguracja sesji uruchamiania w ‘<em>.vscode/launch.json</em>’</p>

<div class="language-json highlighter-rouge">
<div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GDB-REMOTE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cppdbg"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/main"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"miDebuggerServerAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"opi.usb:1234"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"miDebuggerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/usr/bin/gdb-multiarch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"targetArchitecture"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arm64"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"stopAtEntry"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"environment"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nl">"externalConsole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MIMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gdb"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"setupCommands"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sets target architecture"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-ex 'set architecture aarch64'"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ignoreFailures"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable pretty-printing for gdb"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-enable-pretty-printing"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ignoreFailures"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>

<h2 id="4-kruczki-i-sztuczki">
<span class="me-2">4. Kruczki i sztuczki</span><a href="#4-kruczki-i-sztuczki" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<h3 id="41-zdalny-dostęp-do-konta-administratora-bez-podawania-hasła">
<span class="me-2">4.1 Zdalny dostęp do konta administratora bez podawania hasła</span><a href="#41-zdalny-dost%C4%99p-do-konta-administratora-bez-podawania-has%C5%82a" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ol>
  <li>
    <p>Zdalny dostęp do konta administratora</p>

    <p>W pliku <em>/etc/ssh/sshd_config</em>’ (<em>target</em>) należy ustawić opcję</p>

    <pre><code class="language-txt"> PermitRootLogin   yes
</code></pre>
  </li>
  <li>
    <p>Logowanie bez konieczności podawania hasła</p>
    <ul>
      <li>
        <p>Serwer <em>ssh</em> musi zezwalać na uwierzytelnienie za pomocą kluczy publicznych.
W pliku <em>/etc/ssh/sshd_config</em>’ (<em>target</em>) należy ustawić opcje</p>

        <pre><code class="language-txt">PubkeyAuthentication   yes
AuthorizedKeysFile    .ssh/authorized_keys    .ssh/authorized_keys2
</code></pre>
      </li>
      <li>
        <p>Użytkownik systemu <em>host</em> musi mieć wygenerowane osobiste klucze <em>ssh</em>. Generacja komendą</p>

        <pre><code class="language-txt">ssh-keygen
</code></pre>

        <p>Opcją ‘-t’ można wymusić typ klucza, a opcją ‘-b’ jego długość. Wygenerowane klucze, prywatny i publiczny, umieszczone są w podkatalogu ‘.ssh’ katalogu domowego (publiczny ma rozszerzenie ‘pub’).</p>
      </li>
      <li>
        <p>Klucz publiczny należy umieścić na systemie <em>target</em> w pliku ‘<em>.ssh/authorized_keys</em>’ na
koncie docelowym. Wygodne kopiowanie zapewnia komenda (poniżej użyto konta <em>root</em>)</p>

        <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>ssh-copy-id root@opi.usb
</pre></td>
</tr></tbody></table></code></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<!-- ### Pobranie głównego systemu plików z działającego urządzenia

Jeżeli główny system plików archiwizujemy z działającego urządzenia *target*, to przed operacją archiwizacji katalog główny należy zamontować w innym miejscu przy użyciu 'mount --bind' i dopiero w nim wydać komendę archiwizacji. Wynik archiwizacji najlepiej od razu pobrać na system *host*

```sh
ssh root@opi.usb 'mkdir -p /tmp/rootfs && mount --bind / /tmp/rootfs && cd /tmp/rootfs/ && tar cf - *' > rootfs.tar
```

W powyższej komendzie *opi.usb* to nazwa sieciowa urządzenia *target* i może być zastąpiona przez jego numer IP. -->

<h3 id="42-udostępnianie-głównego-systemu-plików-poprzez-nfs">
<span class="me-2">4.2 Udostępnianie głównego systemu plików poprzez NFS</span><a href="#42-udost%C4%99pnianie-g%C5%82%C3%B3wnego-systemu-plik%C3%B3w-poprzez-nfs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<h4 id="system-target">
<span class="me-2">System <em>target</em></span><a href="#system-target" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<ol>
  <li>
    <p>Instalacja serwera NFS.</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> apt <span class="nb">install</span> <span class="nt">-y</span> nfs-kernel-server
</pre></td>
</tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Udostępnienie katalogu ‘/usr’ w trybie tylko do odczytu</p>

    <p>Zatrzymanie serwera</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> systemctl stop nfs-kernel-server
</pre></td>
</tr></tbody></table></code></div>    </div>

    <p>Aktualizacja ‘/etc/exports’</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> /usr <span class="k">*</span><span class="o">(</span>ro,sync,no_subtree_check<span class="o">)</span>
</pre></td>
</tr></tbody></table></code></div>    </div>

    <p>Uruchomienie serwera</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre> exportsfs <span class="nt">-ra</span>
 systemctl start nfs-kernel-server
</pre></td>
</tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h4 id="system-host">
<span class="me-2">System <em>host</em></span><a href="#system-host" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<ol>
  <li>
    <p>Utworzenie punktu montowania</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> <span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/sysroot/usr
</pre></td>
</tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Montowanie zdalnego folderu na żądanie. W ‘/etc/fstab’</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> opi.usb:/usr /mnt/sysroot/usr  nfs noauto,nofail,noatime,nolock  0 0
</pre></td>
</tr></tbody></table></code></div>    </div>

    <p>Montowanie komendą</p>

    <div class="language-sh highlighter-rouge">
<div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Skopiowano!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre> <span class="nb">sudo </span>mount /mnt/sysroot/usr
</pre></td>
</tr></tbody></table></code></div>    </div>

    <p>Kompilator należy poinformować, że katalogiem ‘<em>sysroot</em>’ jest ‘<em>/mnt/sysroot</em>’.</p>
  </li>
</ol>

<p>P.S. <em>Chętnie się dowiem jak prosto udostępnić “/” w którym są linki symboliczne np. <code class="language-plaintext highlighter-rouge">bin-&gt;/usr/bin</code></em>.</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw me-1"></i>
      
      <a href="/tags/c-c/" class="post-tag no-text-decoration">C/C++</a>
      
      <a href="/tags/sbc/" class="post-tag no-text-decoration">SBC</a>
      
      <a href="/tags/docker/" class="post-tag no-text-decoration">Docker</a>
      
      <a href="/tags/devcontainers/" class="post-tag no-text-decoration">DevContainers</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        Jeżeli nie zaznaczono inaczej materiały ob jęte są licencją 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
        .

      
    </div>

    <!-- Post sharing snippet -->

<div class="share-wrapper">
  <span class="share-label text-muted me-1">Podziel się</span>
  <span class="share-icons">
    
    
    

    
      
      <a href="https://twitter.com/intent/tweet?text=Jak%20kompilowa%C4%87%20i%20debugowa%C4%87%20aplikacje%20w%20C/C++%20na%20komputery%20jednop%C5%82ytkowe%20korzystaj%C4%85c%20z%20VS%20Code%20-%20Net%20i%20Dev%20Blog&amp;url=https%3A%2F%2Fmikroprofesor.duckdns.org%2Fposts%2FC-Cpp-development-for-SBC-in-Code%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    
      
      <a href="https://www.facebook.com/sharer/sharer.php?title=Jak%20kompilowa%C4%87%20i%20debugowa%C4%87%20aplikacje%20w%20C/C++%20na%20komputery%20jednop%C5%82ytkowe%20korzystaj%C4%85c%20z%20VS%20Code%20-%20Net%20i%20Dev%20Blog&amp;u=https%3A%2F%2Fmikroprofesor.duckdns.org%2Fposts%2FC-Cpp-development-for-SBC-in-Code%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a href="https://t.me/share/url?url=https%3A%2F%2Fmikroprofesor.duckdns.org%2Fposts%2FC-Cpp-development-for-SBC-in-Code%2F&text=Jak%20kompilowa%C4%87%20i%20debugowa%C4%87%20aplikacje%20w%20C/C++%20na%20komputery%20jednop%C5%82ytkowe%20korzystaj%C4%85c%20z%20VS%20Code%20-%20Net%20i%20Dev%20Blog" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Link" data-title-succeed="Link skopiowano!">
      <i class="fa-fw fas fa-link pe-none"></i>
    </button>
  </span>
</div>


  </div>
<!-- .post-tail-bottom -->

</div>
<!-- div.post-tail-wrapper -->


      
    
      
    </div>
  </div>
  <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
    <div class="access">
      <!-- Get the last 5 posts from lastmod list. -->















      <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Popularne znaczniki</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">C/C++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/code/">Code</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devcontainers/">DevContainers</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sbc/">SBC</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devcontainer/">DevContainer</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/esp-prog/">ESP-Prog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/esp32/">ESP32</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/github-actions/">Github Actions</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hugo/">Hugo</a>
      
    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="ps-0 pe-4 mb-5">
    <div class="panel-heading ps-3 pt-2 mb-2">Spis treści</div>
    <nav id="toc"></nav>
  </div>


    
  </div>
</div>

<!-- tail -->

  <div class="row">
    <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5">
      
        
        <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  
    










  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ms-1" data-toc-skip>
      Więcej
    </h3>
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <div class="col">
          <a href="/posts/emulated-building-for-SBC/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1691913521" data-df="ll">
  Aug 13, 2023
</em>

              <h4 class="pt-0 my-2" data-toc-skip>Budowanie aplikacji dla SBC w środowisku emulowanym</h4>
              <div class="text-muted small">
                <p>
                  





                  Komputery jednopłytkowe (ang. SBC — Single Board Computer) to uniwersalne urządzenia mikroprocesorowe pracujące pod kontrolą systemu operacyjnego.
Zazwyczaj systemem tym jest Linux.
Architektury ko...
                </p>
              </div>
            </div>
          </a>
        </div>
      
    </div>
    <!-- .card-deck -->
  </div>
  <!-- #related-posts -->


      
        
        <!-- Navigation buttons at the bottom of the post. -->

<div class="post-navigation d-flex justify-content-between">
  
    <a href="/posts/static-site-in-hugo/" class="btn btn-outline-primary" prompt="Starsze">
      <p>Jak założyć i utrzymywać statyczny serwis WWW wykorzystując Docker'a, Code i Hugo</p>
    </a>
  

  
    <a href="/posts/how-to-debug-esp32-with-esp-prog/" class="btn btn-outline-primary" prompt="Nowsze">
      <p>Jak uruchamiać programy dla ESP32 korzystając z ESP-Prog</p>
    </a>
  
</div>

      
        
        <!--  The comments switcher -->


      
    </div>
  </div>


        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 post-content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Popularne znaczniki</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">C/C++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/code/">Code</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devcontainers/">DevContainers</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sbc/">SBC</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devcontainer/">DevContainer</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/esp-prog/">ESP-Prog</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/esp32/">ESP32</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/github-actions/">Github Actions</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hugo/">Hugo</a>
      
    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>
    </div>

    <!-- The Footer -->

<footer>
  <div class="container px-lg-4">
    <div class="d-flex justify-content-center align-items-center text-muted mx-md-3">
      <p>Do realizacji wykorzystano <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> i styl <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
      </p>

      <p>©
        2023
        <a href="https://github.com/username">PeJotZet</a>.
        
          <span data-bs-toggle="tooltip" data-bs-placement="top" title="Z opublikowanymi materiałami można robić co się chce. Można nawet sprzedawać na serwisach aukcyjnych.">Korzystaj póki możesz.</span>
        
      </p>
    </div>
  </div>
</footer>


    <div id="mask"></div>

    <button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow">
      <i class="fas fa-angle-up"></i>
    </button>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false">
        <div class="toast-header">
          <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="px-2 mb-3">Opublikowano nowe treści.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Aktualizacja
          </button>
        </div>
      </div>
    

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/pl.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>
